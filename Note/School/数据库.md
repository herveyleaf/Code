# 第一章 绪论

## 数据库系统概述

### 数据库的4个基本概念

#### 数据

数据是数据库中存储的基本对象

#### 数据库(DB)

数据库是长期储存在计算机内、由组织的、可共享的大量数据的集合

基本特征：
- 数据按一定的数据模型组织、描述和储存
- 可为各种用户共享
- 冗余度较小
- 数据独立性较高
- 易扩展

#### 数据库管理系统(DBMS)

操纵和管理数据库的大型软件，用于建立、使用和维护数据库

主要功能：
- 数据定义：提供数据定义语言(DDL)
- 数据组织、存储和管理
- 数据操纵：提供数据操纵语言(DML)
- 数据库的事务管理和运行
- 数据库的建立和维护
- 其他功能

#### 数据库系统(DBS)

数据库系统的构成：
- 用户
- 数据库
- 数据库管理系统
- 应用系统
- 数据库管理员

### 数据管理技术的产生和发展

数据管理：对数据进行分类、组织、编码、存储、检索和维护

### 数据库系统的特点

- 数据结构化
- 数据的共享性高、冗余度低且一扩充
- 数据独立性高
- 数据由数据库管理系统统一管理和控制

## 数据模型

数据模型就是现实世界的模拟

数据模型应满足：
- 比较真实的模拟现实世界
- 容易为人所理解
- 便于在计算机上实现

数据模型是数据库系统的核心和基础

### 两类数据模型

数据模型分为两类(两个不同的层次，三个模型)
- 概念模型（也称信息模型），按用户的观点来对数据和信息建模，用于数据库设计
- 逻辑模型（也称数据模型）和物理模型
    - 逻辑模型主要包括网状模型、关系模型等，按计算机系统的观点对数据建模，用于DBMS实现
    - 物理模型是对数据最底层的抽象，描述数据在系统内部的表示方法和存取方法

客观对象的抽象过程
- 现实世界中的客观对象抽象为概念模型
- 概念模型转换为某一数据库管理系统支持的数据模型

### 概念模型

#### 实体联系方法

用E-R图来描述现实世界的概念模型

E-R方法也称为E-R模型

### 数据模型的组成要素

- 数据结构
- 数据操作
- 数据的完整性约束条件

### 常用的数据模型

- 层次模型
- 网状模型
- 关系模型
- 面向对象数据模型
- 对象关系数据模型
- 半结构化数据模型

### 层次模型

数据库系统中最早出现的数据模型

层次模型用**树状结构**来表示各类实体以及实体间的联系

### 网状模型

### 关系模型

在用户观点下，每个关系的数据结构是一张二维表，由行和列组成

#### 数据结构
- 关系：一个关系通常对应一个表
- 元组：表中的一行即为一个元组
- 属性：表中的一列即为一个属性
- 主码：也称码键，可以唯一确定一个元组
- 域：一组具有相同数据类型的值的集合
- 分量：元组中的一个属性值
- 关系模式：对关系的描述

## 数据库系统的结构

从数据库应用开发人员角度看，数据库系统通常采用三级模式结构，是数据库系统内部的系统结构

从数据库用户角度看，数据库系统的结构分为：
- 单用户结构
- 主从式结构
- 分布式结构
- 客户-服务器
- 浏览器-应用服务器/数据库服务器多层结构

### 数据库系统模式的概念

- 型(Type)：对某一类数据的结构和属性的说明
- 值(Value)：是型的一个具体赋值
- 模式：是型的描述，不涉及具体值
- 实例：模式的一个具体值

### 数据库系统的的三级模式结构

#### 模式（也称逻辑模式）

数据库中全体数据的逻辑结构和特征的描述

一个数据库只有一个模式，是数据库系统模式结构的中间层

#### 外模式（也称子模式或用户模式）

数据库用户使用的局部数据的逻辑结构和特征的描述

介于模式与应用之间

#### 内模式（也称存储模式）

是数据物理结构和存储方式的描述

一个数据库只有一个内模式

### 数据库的二级映像功能与数据独立性

三级模式是对数据的三个抽象级别

二级映像在数据库管理系统内部实现这三个抽象层次的联系与转换

#### 外模式/模式映像

每一个外模式，数据库系统都有一个外模式/模式映像，定义外模式与模式之间的对应关系

映像通常包含在各自外模式的描述中，保证数据的逻辑独立性

#### 模式/内模式映像

定义了数据全局逻辑结构与存储结构之间的对应关系

模式/内模式映像是唯一的，该映像定义通常包含在模式描述中，保证数据的物理独立性

## 数据库系统的组成

- 数据库
- 数据库管理系统
- 应用程序
- 数据库管理员
- 硬件平台及数据库
- 软件
- 人员

# 第二章 关系数据库

## 关系数据结构及形式化定义

### 关系

单一的数据结构->关系  
逻辑结构->二维表  

#### 域

一组具有相同数据类型的值的集合

#### 笛卡尔积

所有域的所有取值的一个组合，不能重复

- 元组：笛卡尔积中每一个元组叫做一个n元组，或简称为元组
- 分量：笛卡尔积元素中的每一个值叫做一个分量
- 基数：即行数，若Di为有限集，其基数为mi,的D1 * D2 * ... * Dn的基数M为：m1 * m2 * ... * mn
- 目数：即列数，相加得出

### 关系模式

#### 什么是关系模式

关系是值，关系模式是型，关系模式是对关系的描述

#### 定义关系模式

可形式化的表示为：R(U, D, DOM, F)
R表示关系名，U表示组成该关系的属性名集合， D表示属性组U中属性所来自的域， DOM表示属性向域的映像合计，F表示属性间的数据依赖关系集合

#### 关系模式与关系

- 关系模式：对关系的描述，静态的、稳定的
- 关系：关系模式在某一时刻的状态或内容，动态的、随时间变化的

关系模式和关系往往统称为关系

## 关系操作

### 基本关系操作

常用的关系操作：
- 查询：选择、投影、连接、除、并、交、差
- 数据更新：插入、删除、修改

选择、投影、并、差、笛卡尔积是5种基本操作

关系操作的特点：集合操作方式

### 关系数据库语言的分类

- 关系代数语言
- 关系演算语言
- 具有关系代数和关系演算双重特点的语言

## 关系完整性

### 关系的三类完整性约束

- 实体完整性和参照完整性：关系模型必须满足的完整性约束条件，称为关系的两个不变形
- 用户定义的完整性

### 实体完整性

若属性A是基本关系R的主属性，则属性A不能取空值

### 参照完整性

#### 外码

F是基本关系R的一个或一组属性，但不是关系R的码。如果F与基本关系S的主码K相对应，则称F是基本关系R的外码

基本关系R称为参照关系，基本关系R称为被参照关系或目标关系

#### 参照完整性规则

若F是基本关系R的外码，与基本关系S的主码K对应，则F的取值必须为空值或S中某个元组的主码值

### 用户定义的完整性

针对某一具体关系数据库的约束条件

## 关系代数

用到的运算符包括两类，集合运算符和专门的关系运算符

### 传统的集合运算

#### 并

对于关系R和S，两个关系应该具有相同的目n,相同的属性应该取自同一个域

并的结果仍为n目关系

#### 差

同并

#### 交

同并

#### 笛卡尔积

### 专门的关系运算

#### 选择

又称限制

在关系R中选择满足给定条件的诸元组

#### 投影

从R中选择出若干属性列组成新的关系

#### 连接

从两个关系的笛卡尔积中选取属性间满足一定条件的元组

- 等值连接：从关系R与S的广义笛卡尔积中选取A、B属性值相等的那些元组
- 自然连接：一种特殊的等值连接，在结果中把重复的属性列去掉
- 外连接：把舍弃的元组也保留在结果关系中，在其他属性上填空值
    - 左外连接：只把左边关系中要舍弃的元组保留
    - 右外连接：只把右边关系中要舍弃的元组保留

#### 除

# 关系数据库标准语言SQL

## SQL概述

结构化查询语言，是关系数据库的标准语言

### SQL的特点

- 综合统一：
    
    集数据定义语言(DDL)，数据操纵语言(DML)，数据控制语言(DCL)为一体，可以独立完成数据库生命周期中的全部活动

- 高度非过程化：

    只需要提出做什么，无须了解存取路径

- 面向集合的操作方式

- 以同一种语法结构提供多种使用方式

- 语言简洁，易学易用

### SQL的基本概念

支持关系数据库三级模式结构

## 数据定义

SQL的数据定义功能：模式定义、表定义、视图和索引的定义

### 模式的定义与删除

- 定义：create schema <模式名> authorization <用户名>
- 删除：drop schema <模式名> <cascade|restrict>
    - cascade 级联：删除模式的同时把该模式中所有的数据库对象全部删除
    - restrict 限制：仅当该模式中没有任何下属的对象时才能执行

### 基本表的定义、删除与修改

#### 定义

create table <表名>
    (<列名> <数据类型> [<列级完整性约束条件>]  
    ...  
    <表级完整性约束条件>);

#### 修改

alter table <表名>  
...

#### 删除

drop table <表名> [restrict|cascade]

- restrict：删除表是有限制的，如果存在依赖该表的对象，则表不能被删除
- cascade：删除表没有限制，相关的依赖对象一起删除

### 索引的建立与删除

#### 建立

create [unique|cluster] index <索引名>  
on <表名> (<列名> <次序>, ...)

#### 修改

alter index <旧索引名> rename to <新索引名>

#### 删除

drop index <索引名>

### 数据字典

是关系数据库管理系统内部的一组系统表，记录了数据库中所有定义信息

## 数据查询

select <目标列表达式>  
from <表名或视图名> as <别名>  
where <条件表达式>  
group by <列名>  
having <条件表达式>  
order by <列名> [asc|desc]

# 数据库完整性

数据库的完整性即数据的正确性和相容性

数据的完整性和安全性是两个不同的概念
- 数据的完整性
    - 防止数据库中存在不正确的数据
    - 防范对象：不符合语义的、不正确的数据
- 数据的安全性
    - 保护数据库防止恶意的破坏和非法的存取
    - 防范对象：非法用户和非法操作

为了维护数据库的完整性，DBMS必须：
1. 提供定义完整性约束条件的机制
2. 提供完整性检查的方法
3. 违约处理

## 实体完整性

### 实体完整性的定义

关系模型的实体完整性由创建表时用primary key定义

单属性构成的码有定义为列级约束条件和定义为表级约束条件两种说明方法

对多个属性构成的码只有定义为表级约束条件一种说明方法

### 实体完整性检查和违约处理

插入或对主码列进行更新操作时，RDBMS按照实体完整性规则自动进行检查：
- 检查主码是否唯一：全表扫描
- 检查主码各个属性是否为空

## 参照完整性

### 参照完整性定义

关系模型的实体完整性由创建表时用foreign key定义外码  
用references指明外码参照哪些表的主码

### 参照完整性检查和违约处理

#### 可能破坏参照完整性的情况

- 在参照表进行操作：
    - 插入元组
    - 修改外码值
- 在被参照表进行操作：
    - 删除元组
    - 修改主码值

#### 违约处理

- 拒绝：默认策略
- 级联
- 设为空值：对于参照完整性，除了定义外码，还应定义外码列是否允许空值

## 用户定义的完整性

由RDBMS提供，不必由应用程序承担

创建表时定义，有：
- not null
- unique
- check

## 完整性约束命名子句

constraint <完整性约束条件名>  
[primary key | foreign key | check]

# 关系数据理论

## 数据依赖

### 函数依赖(FD)

y=f(x)，当x确定之后，y也就唯一的确定了，这种类似函数的关系就叫函数依赖

### 多值依赖(MVD)

## 规范化

规范化理论是用来改造关系模式，通过分解关系模式来消除其中不合适的数据依赖，以解决插入异常、删除异常、更新异常和数据冗余的问题

### 函数依赖

对于属性集U的子集X和Y
- 如果X->Y，但Y不是X的子集，则X->Y是非平凡的函数依赖
- 如果X->Y，但Y是X的子集，则X->Y是平凡的函数依赖
- 如果X->Y，且对X的任何一个真子集X'都不存在X'->Y，则成Y对X完全函数依赖
- 如果X->Y，但Y不完全依赖于X，则成Y对X部分函数依赖
- 如果X->Y，Y->X，Y->Z，则成Z对X传递函数依赖

### 码

K为关系R<U, F>中的属性或属性组合，若K->U，则称K为R的候选码，若候选码多于一个，则选定其中一个作为主码

包含在任何一个候选码中的属性称为主属性，不包含在任何码中的属性称为非主属性

整个属性组是码，则称为全码

### 范式

范式是符合某一级别的关系模式的集合

范式的种类：
- 第一范式
- 第二范式
- 第三范式
- BC范式
- 第四范式

低一级的范式可以通过模式分解转换为若干个高一级范式的关系模式的集合，这个过程叫做规范化

#### 1NF

一个关系模式R的所有属性都是不可分的基本数据项

#### 2NF

满足第一范式，且每一个非主属性完全依赖于主码

#### 3NF

满足第二范式，且每一个非主属性既不部分依赖于码，也不传递依赖于码

#### BCNF

满足第三范式，且对于所有的函数依赖X->Y，每一个决定因素X都包含了R的一个候选码

关系R属于BCNF是属于3NF的充分不必要条件

### 多值依赖

设R(U)是属性集合U上的一个关系模式，X、Y和Z是U的子集，且Z=U-X-Y

当且仅当对R的任何一个关系r在(X, Z)上的每个值对应一组Y的值，这组值仅仅决定于X而与Z无关，则称X多值依赖于Y，记作X->->Y

若Z=空集，则称为平凡的多值依赖，否则称为非平凡的多值依赖

## 数据依赖的公理系统

对于满足一组函数依赖F的关系模式R<U, F>，其任何一个关系r，若函数依赖X->Y都成立，则称F逻辑蕴含X->Y

### Armstrong公理系统

- 自反律：若Y是X的子集，X又是U的子集，则X->为F所蕴含
- 增广律：若X->Y为F所蕴含，且Z是U的子集，则XZ->YZ为F所蕴含
- 传递律：若X->Y及Y->Z为F所蕴含，则X->Z为F所蕴含
- 合并律：若X->Y和X->Z在R上成立，则X-YZ也成立
- 伪传递律：若X-Y，YW->Z，则XW->Z也成立
- 分解律：若X->YZ，则X-Z，X->Y
- 复合律：若X-Y，W-Z，则XW->YZ

### 函数依赖闭包

在关系模式R<U, F>中为F所逻辑蕴含的函数依赖的全体叫做F的闭包

X是U的子集，对于全体能由F根据Armstrong公理导出的X->A中的A，称为X关于函数依赖F的闭包

### 函数依赖集的等价、覆盖和最小函数依赖集

若关系模式R的两个函数依赖集F和G，若F的闭包=G的闭包，则称F和G是等价的函数依赖集，若F和G等价，就称F覆盖G或G覆盖F

#### 最小函数依赖集

- 每个函数依赖的右边都是单属性
- Fmin中没有冗余的函数依赖，即减少任何一个函数依赖都与原来的不等价
- 每个函数依赖左边没有冗余的属性，即减少任何一个函数依赖左边的属性后，都与原来的F不等价

#### 最小函数依赖集算法

- 将F中的函数依赖利用分解律，分解为右侧都是单属性的函数依赖G
- 去掉G中每个函数依赖左边多余的属性
- 消除多余的函数依赖

### 候选码算法

- 若X是L类属性，则X必为任一候选码成员
- 若X是L类属性，且X的闭包包含了全部属性，则X是唯一候选码
- 若X是R类属性，X肯定不在候选码中
- 若X是N类属性，则X肯定是任一候选码成员
- 若X是N类属性和L类属性的集合，且X的闭包包含了全部属性，则X是唯一候选码
- LR类不一定

X代表L,N类属性，Y代表LR类属性

1. 若X的闭包包含全部属性，则X是唯一候选码
2. 若X的闭包不包含全部属性，必须跟Y类属性组合
3. 从Y中取出一个属性A,若XA的闭包包含了全部属性，则是候选码成员，去掉A，换B与X组合，再判断XB的闭包
4. 在Y中去掉成为候选码成员的单一属性后，再从Y中剩余属性中取出2个、3个属性，与X组合，把所有闭包是全部属性的属性集找出来
5. 这些属性集就是候选码

# 数据库设计

## 数据库设计概述

### 数据库设计的特点

- 技术：数据库系统开发技术
- 管理：
    - 数据库建设项目管理
    - 企业的业务管理
- 基础数据：收集、入库、更新新的数据

将结构设计和行为设计相结合

### 数据库设计方法

- 手工与经验相结合方法：一边设计一边运行，根据经验来设计，很多错误
- 范式设计方法
    - 新奥尔良法
    - **基于E-R模型的数据库设计方法**
    - 面向对象的数据库设计方法
    - 3NF法
    - 统计建模语言

### 数据库设计的基本步骤

分为6个阶段：
- 需求分析
    - 了解与分析用户需求，处理数据
    - 最困难最耗时的一步
- 概念结构设计
    - 整个数据库设计的关键
    - 对用户需求进行综合、归纳和抽象，形成一个独立于具体DBMS的概念模型
- 逻辑结构设计
    - 将概念结构转化为某个DBMS所支持的数据模型，对其进行优化
- 物理结构设计
    - 为逻辑数据模型选取一个最适合应用环境的物理结构（存储结构和存取方法）
- 数据库实施
- 数据库运行和维护

需求分析和概念设计独立于任何数据库管理系统

逻辑设计和物理设计与选用的DBMS密切相关

## 需求分析

### 需求分析的任务

需求分析就是分析用户的要求，是设计数据库的起点

任务具体是：
- 详细调查现实世界要处理的对象
- 充分了解原系统
- 明确业务内容
- 明确用户的各种需求

调查的重点是：数据和处理，获得用户对数据库的要求

### 需求分析的方法

- 调查需求
- 达成共识
- 分析表达需求

### 数据字典

#### 数据字典的用途

进行详细的数据收集和数据分析所获得的主要结果

在需求分析阶段建立，在数据库设计过程中不断修改

#### 数据字典的内容

数据项、数据结构、数据流、数据存储、处理过程

其中数据项是数据的最小组成单位，若干个数据项可以组成一个数据结构

- 数据项

    数据项是不可再分的数据单位

    对数据项的描述：

    数据项描述 = {数据项名，数据项含义说明，别名，数据类型，长度，取值范围，取值含义，与其他数据项的逻辑关系，数据项之间的关系}

    eg.：学生姓名 = {学生姓名，姓名，字符串，20位，中文汉字，学生姓名->所在专业}

- 数据结构

    反映了数据之间的组合关系

    对数据结构的描述：

    数据结构描述 = {数据结构名，含义说明，组成：{数据项或数据结构}}

    eg.：学生信息 = {学生信息，描述学生基本信息，组成：{姓名，学号，年龄}}

- 数据流

    数据流是数据结构在系统内传输的路径

    对数据流的描述：

    数据流描述 = {数据流名，说明，数据流来源，数据流去向，组成：{数据结构}，平均流量，高峰期流量}

    数据流去向说明该数据流将到哪个过程去；平均流量指单位时间里的传输次数；高峰期流量指高峰时期的数据流量

    eg.：对体检结果的描述 = {体检结果，学生参加体检的最终结果，体检，批准，组成...}

- 数据存储

    是数据结构停留或保存的地方，也是数据流的来源和去向之一

    对数据存储的描述：

    数据存储描述 = {数据存储名，说明，编号，输入的数据流，输出的数据流，组成：{数据结构}，数据量，存取频度，存取方式}

- 处理过程

    具体处理逻辑一般用判定表或判定树来描述

    处理过程说明性信息的描述：

    处理过程描述 = {处理过程名，说明，输入：{数据流}，输出：{数据流}，处理：{简要说明}}

## 概念结构

概念结构设计是将需求分析得到的用户需求抽象为信息结构的过程，是整个数据库设计的关键

现实世界->信息世界->机器世界

概念结构的设计特点：
- 能真实、充分的反应现实世界
- 易于理解、更改
- 易于向关系、网状、层次等各种数据模型转换

### E-R图

#### 实体型

用矩形表示，矩形框内写明实体名

#### 属性

用椭圆形表示，并用无向边将其与相应的实体连接起来

#### 联系

- 联系本身：

    用菱形表示，菱形框内写明联系名，并用无向边分别于有关实体连接起来，同时在无向边旁边标上联系的类型

- 联系的属性：

    联系本身也是一种实体型，也可以有属性

## 逻辑结构设计

### E-R图向关系模型的转换

转换原则：
- 一个实体型转换为一个关系模式
    - 关系的属性：实体型的属性
    - 关系的码：实体型的码
- 一个m:n联系转换为一个关系模式
    - 关系的属性：与该联系相连的各实体的码以及联系本身的属性
    - 关系的码：各实体码的组合
- 一个1:n联系可以转换为一个独立的模式，也可以与n端对应的关系模式合并
    - 转换为一个独立的关系模式
        - 关系的属性：与该联系相连的各实体的码以及联系本身的属性
        - 关系的码：n端实体的码
    - 与n端对应的关系模式合并
        - 合并后关系的属性：在n端关系中加入1端关系的码和联系本身的属性
        - 合并后关系的码：不变
- 一个1:1联系可以转换为一个独立的关系模式，也可以与任意一端对应的关系模式合并
    - 转换为一个独立的关系模式
        - 关系的属性：与该联系相连的各实体的码以及联系本身的属性
        - 关系的候选码：每个实体的码均是该关系的候选码
    - 与某一端对应的关系模式的和并
        - 合并后关系的属性：加入对应关系的码和联系本身的属性
        - 合并后关系的码：不变

## 物理设计

数据库在物理设备上的存储结构与存取方法称为数据库的物理结构

为一个给定的逻辑数据模型选取一个最适合应用环境的物理结构的过程就是数据库的物理设计