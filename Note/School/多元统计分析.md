# 第二章 多元线性模型

## 多元线性模型

### 模型定义

多元线性模型通常用来描述变量y与多个x变量之间的随机线性关系，即y = β0 + β1x1 + ... + βpxp + ε  
x1, x2, ..., xp是非随机的自变量，y是随机的因变量，β0是常数项，β1, β2, ..., βp是回归系数，ε是随机误差项

若对y和x进行n次观测，得到n组观测值，引入矩阵，则上式可写成y = Xβ + ε  
式中，y是n×1观测向量，X是n×(p+1)已知设计矩阵，β是(p+1)×1未知参数向量，ε是n×1随机误差向量

若y = Xβ + ε模型为普通线性回归模型，且模型的随机误差项服从正态分布，则称模型为普通正态线性回归模型

### 模型的参数估计和检验

R中的回归分析过程为 ***lm()***，可以完成回归系数的估计，以及方程和回归系数的显著性检验

**lm()** 的作用是建立线性回归方程，使用方法如下  
lm.exam <- lm(y~x1+x2+x3+x4+x5, data = d2.1)

## 变量选择

最优回归方程指的是从可供选择的所有自变量中选出对因变量有显著影响的变量来建立回归方程

R中的逐步回归法的计算函数 ***step()*** 是以AIC为模型选择准则来选择变量，AIC值越小，认为模型越好

**step()** 的作用是进行逐步回归，使用方法如下  
lm.step <- step(lm.exam, direction = "both")

## 回归诊断

### 残差分析和异常点探测

残差分析可以诊断模型的基本假设是否成立

在R中，分别采用 ***residuals(), rstandard()和rstudent()*** 来计算普通残差、标准化残差和学生化残差

如果回归模型能够很好的描述拟合的数据，那么残差对预测值的散点图应该像一些随机散布的点，如果某个点的残差很大，则说明这个点偏离数据主体比较远，**一般把标准化残差的绝对值大于等于2的观测值认为是可疑点，大于等于3的观测值认为是异常点**

若绘制散点图后发现残差的分布有随预测值增大而减小的趋势，则同方差性的基本假定可能不成立，此时可通过对因变量作适当方差稳定变化来解决方差非齐问题，常见的方差稳定变换有：
1. 对数变换
2. 开方变换
3. 倒数变换
4. Box-Cox变换

例如对模型进行对数变换  
lm.step_new <- update(lm.step, log(.)~.)

找出异常的观测值后，去掉这些观测值再建立全变量回归方程，例如  
lm.exam <- lm(log(y)~x1+x2+x3+x4, data = d2.1[-c(19),])

### 回归诊断的一般方法

R中使用函数 ***plot()和influence.measures()*** 绘制诊断图和计算诊断统计量，使用方法如下  
plot(lm.step_new)  
influence.measures(lm.step_new)

## 回归预测

回归预测分为点预测和区间预测两种，在R中，***predict()*** 用来计算回归模型的预测值，例如  
preds <- data.frame(x2 = 80, x3 = 90)  
predicts(lm.step, newdata = preds, interval = "prediction", level = 0.95)  
其中interval = "prediction"表示要给出区间预测

# 广义线性模型

## Logistic模型

y服从二项分布

R中的广义线性模型过程 ***glm()*** 可以完成回归系数的估计，以及模型回归系数的显著性检验，例如  
glm.logit <- glm(y~x1+x2, family = binomial(link = logit), data = d3.1)

其中link = logit即为使用Logistics模型

## Probit模型

y服从二项分布

即将**glm()函数中的family = binomial(link = ...) 写为link = probit**

## 多项Logit模型

Logistic和Probit模型的因变量为二水平分类变量，分类变量有两个以上的水平且这些水平为仅有的可能水平时，可才用多项Logit模型

采用 ***nnet包中的multinom()*** 函数可以完成多项Logit模型的拟合，使用方法如下  
mlog <- multinom(y~x1+x2, data = d3.2)

## 泊松对数线性模型

y服从泊松分布

glm.ln <- glm(y~x1+x2+x3, family = poisson(link = log), data = d3.3)

## 零膨胀计数模型

y服从泊松分布，但y取0的可能性很大

需要实现加载程序包pscl，例如  
library(pscl)  
a2 <- zeroinfl(deaths~hiv+fac+age+py, data = d3.4)

## 多项分布对数线性模型

w.fit <- glm(Freq~Class+Sex+Age, family = poisson, data = w, offset = log(n))