# 第二章

## 应用层协议原理

研发网络应用程序的核心是写出能够运行在不同的端系统和通过网络彼此通信的程序  
例如，在web应用程序中，有两个互相通信的不同的程序，一个是运行在用户主机上的浏览器程序，另一个是运行在web服务器主机上的web服务器程序

### 网络应用程序体系结构

现代网络应用程序中所使用的两种主流体系结构：**客户-服务器体系结构**或**对等(P2P)体系结构**

#### 客户-服务器体系结构

在此体系结构中，有一个总是打开的主机称为**服务器**，它服务于来自许多其他称为**客户**的主机的请求  
例如，web应用程序中总是打开的web服务器服务于来自浏览器的请求，当web服务器接收到来自某客户对某对象的请求时，它向该客户发送所请求的对象作为响应

客户-服务器体系结构中，客户相互之间不直接通信

客户-服务器体系结构的另一个特征是该服务器具有固定的、周知的地址，该地址称为IP地址

#### P2P体系结构

在此体系结构中，对位于数据中心的专用服务器有最小的依赖，应用程序在间断连接的主机对之间使用直接通信，这些主机被称为**对等方**

因为这种对等方通信不必通过专门的服务器，该体系结构被称为对等方到对等方的，许多流量密集型应用都是P2P体系结构

P2P体系结构的特性之一是**自扩展性**，例如，在一个P2P文件共享应用中，每个对等方都由于请求文件产生工作负载，但每个对等方通过向其他对等方分发文件也为系统增加服务能力

### 进程通信

在两个不同端系统上的进程，通过跨越计算机网络交换报文而相互通信，发送进程生成并向网络中发送报文，接收进程接收这些报文并可能通过回送报文进行响应

1. **客户和服务器进程**

    在一对进程之间的通信会话场景中，发起通信的进程被标识为**客户**，在会话开始时等待联系的进程是**服务器**

2. **进程与计算机网络之间的接口**

    进程通过一个称为**套接字**的软件接口向网络发送报文和从网络接收报文

    套接字是同一台主机内应用层与运输层之间的接口，由于该套接字是建立网络应用程序的可编程接口，因此套接字也称为应用程序和网络之间的**应用程序编程接口**。应用程序开发者可以控制套接字在应用层端的一切，但是对该套接字的运输层端几乎没有控制权，仅限于：选择运输层协议、设定几个运输层参数

3. **进程寻址**

    在一台主机上运行的进程为了向在另一台主机上运行的进程发送分组，接收进程需要有一个地址。为了标识该接收进程，需要定义两种信息：主机的地址、在目的主机中指定接收进程的标识符

    在Internet中，主机由其IP地址标识，它是一个32比特的量。除了知道报文发送目的地的主机地址外，发送进程还必须指定运行在接收主机上的接收进程(具体地说，接收套接字)，因为一台主机能够运行许多网络应用

### 可供应用程序使用的运输服务

我们大体能够从四个方面对应用程序服务进行分类：可靠数据传输、吞吐量、定时、安全性

1. **可靠数据传输**

    如果一个协议提供了确保数据交付服务(由应用程序的一端发送的数据正确、完全地交付给该应用程序的另一端)，就认为提供了可靠数据传输。当一个运输协议提供这种服务时，发送进程只要将其数据传递进套接字，就可以完全相信该数据将能无差错地到达接收进程

2. **吞吐量**

    一个应用程序能够请求r比特/秒的确保吞吐量，并且该运输协议能够确保可用吞吐量总是为至少r比特/秒。如果运输协议不能提供这种吞吐量，该应用程序或以较低速率进行编码，或可能必须放弃发送，因为接收所需吞吐量的一半是几乎没有或根本没有用处的。居于吞吐量要求的应用程序被称为**一个带宽敏感的应用**

3. **定时**

    运输层协议能够提供定时保证，如同具有吞吐量保证那样，定时保证能够以多种形式实现。例如，发送方注入进套接字中的每个比特到达接收方的套接字不迟于100ms

4. **安全性**

    运输协议能够为应用程序提供一种或多种安全性服务。例如，在发送主机中，运输协议能够加密由发送进程茶u念书的所有数据，在接收主机中，运输层协议能够在将数据交付给接收进程之前解密这些数据。这种服务将在发送和接收进程之间提供机密性，以防该数据以某种方式在这两个进程之间被观察到